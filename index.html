<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>能源快跑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #e0f2f1, #fff);
            overflow: hidden;
        }
        canvas {
            display: block;
            margin: auto;
            background: #c8e6c9;
            border: 4px solid #388e3c;
            border-radius: 10px;
        }
        #hud {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            font-size: 1.2em;
            color: #2e7d32;
        }
        #pauseStatus {
            display: none;
        }
        #startScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 2em;
            color: #388e3c;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #startScreen button {
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #388e3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #startScreen button:hover {
            background-color: #2e7d32;
        }
    </style>
</head>
<body>
<div id="hud">
    <div id="scoreboard">得分：0</div>
    <div id="timer">剩余时间：60秒</div>
    <div id="pauseStatus">暂停中</div>
</div>
<canvas id="gameCanvas" width="800" height="500"></canvas>
<audio id="bgm" src="https://cdn.pixabay.com/download/audio/2023/03/27/audio_1dc7e4d0fd.mp3?filename=arcade-112336.mp3" autoplay loop></audio>
<audio id="jumpSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_a326c93f3f.mp3"></audio>

<div id="startScreen">
    <p>欢迎来到《能源快跑》！</p>
    <button id="startButton">开始游戏</button>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreboard = document.getElementById('scoreboard');
    const timerDisplay = document.getElementById('timer');
    const pauseStatus = document.getElementById('pauseStatus');
    const bgm = document.getElementById('bgm');
    const jumpSound = document.getElementById('jumpSound');
    const startScreen = document.getElementById('startScreen');
    const startButton = document.getElementById('startButton');

    const characterImg = new Image();
    characterImg.src = 'https://cdn-icons-png.flaticon.com/512/3024/3024605.png';

    let player = { x: 50, y: 400, width: 40, height: 40, vy: 0, jump: false, speed: 1.5, movingLeft: false, movingRight: false };
    let ground = 450;
    let gravity = 1;
    let score = 0;
    let timeLeft = 60;
    let speed = 1;  // 方块速度
    let paused = false;

    let items = [];
    let leaderboard = [];

    let questions = [
        { q: '以下哪项是节能行为？', options: ['整晚开灯', '白天利用自然光', '冰箱门常开'], correct: 1 },
        { q: '以下哪项更节能？', options: ['空教室开空调', '拔掉电器插头', '电脑不休眠'], correct: 1 },
        { q: '频繁开关冰箱会怎样？', options: ['省电', '加快制冷', '浪费能源'], correct: 2 },
        { q: '哪种行为更节能？', options: ['将饭菜反复加热', '合理安排用餐量', '长期开灯做作业'], correct: 1 },
        { q: '如何节约空调能耗？', options: ['经常开关', '调至最低温度', '设定合理温度并定期清洗过滤网'], correct: 2 },
        { q: '用电脑后应怎样节能？', options: ['随时关机', '待机不断电', '开启节能模式并及时关闭显示器'], correct: 2 },
        { q: '洗衣更节能的做法是？', options: ['多次少量洗', '集中洗涤、满载使用', '用热水漂洗'], correct: 1 },
        { q: '校园中哪个用电行为应避免？', options: ['空教室灯全开', '走廊传感灯', '公共区域定时照明'], correct: 0 },
        { q: '下列哪种设备最省电？', options: ['白炽灯', '节能灯', '高压钠灯'], correct: 1 },
        { q: '合理安排作息可带来什么节能效果？', options: ['避免夜间照明', '避免清晨活动', '提升能耗'], correct: 0 },
        { q: '以下哪项是绿色出行方式？', options: ['打车', '拼车', '骑自行车'], correct: 2 },
        { q: '教室节能应采取哪种做法？', options: ['下课忘关灯', '随手关灯', '白天也开灯'], correct: 1 },
        { q: '夏天使用空调最合理的温度设置是？', options: ['18℃', '20℃', '26℃'], correct: 2 },
        { q: '充电完成后应做什么？', options: ['继续充电', '拔掉充电器', '无所谓'], correct: 1 },
        { q: '什么样的照明方式更节能？', options: ['集中照明', '过度照明', '边走边开灯'], correct: 0 },
        { q: '在宿舍节能应该避免什么行为？', options: ['电脑挂着下载通宵', '统一作息关灯', '使用节能插座'], correct: 0 }
    ];

    function spawnItem() {
        let q = questions[Math.floor(Math.random() * questions.length)];
        if (Math.random() < 0.5) {
            items.push({
                x: 800,
                y: 400,
                width: 40,
                height: 40,
                question: q,
                answered: false
            });
        }
    }

    function drawPlayer() {
        ctx.drawImage(characterImg, player.x, player.y, player.width, player.height);
    }

    function drawItems() {
        ctx.fillStyle = '#ffcc80';
        items.forEach(item => {
            ctx.fillRect(item.x, item.y, item.width, item.height);
        });
    }

    function updateItems() {
        items.forEach(item => item.x -= speed);
        items = items.filter(item => item.x + item.width > 0);
    }

    function checkCollision() {
        items.forEach(item => {
            if (
                !item.answered &&
                player.x < item.x + item.width &&
                player.x + player.width > item.x &&
                player.y < item.y + item.height &&
                player.y + player.height > item.y
            ) {
                const q = item.question;
                let answer = prompt(`${q.q}\n0: ${q.options[0]}\n1: ${q.options[1]}\n2: ${q.options[2]}`);
                if (parseInt(answer) === q.correct) {
                    score += 10;
                    alert('回答正确！+10分');
                } else {
                    score -= 5;
                    alert('回答错误！-5分');
                }
                item.answered = true;
                scoreboard.innerText = `得分：${score}`;

                player.movingLeft = false;
                player.movingRight = false;
            }
        });
    }

    function gameLoop() {
        if (paused) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#a5d6a7';
        ctx.fillRect(0, ground, canvas.width, 50);

        player.y += player.vy;
        player.vy += gravity;
        if (player.y > ground - player.height) {
            player.y = ground - player.height;
            player.vy = 0;
            player.jump = false;
        }

        if (player.movingLeft && player.x > 0) player.x -= player.speed;
        if (player.movingRight && player.x + player.width < canvas.width) player.x += player.speed;

        drawPlayer();
        updateItems();
        drawItems();
        checkCollision();

        requestAnimationFrame(gameLoop);
    }

    startButton.addEventListener('click', () => {
        startScreen.style.display = 'none';
        gameLoop();
    });

    document.addEventListener('keydown', e => {
        if (e.code === 'Space' && !player.jump) {
            player.vy = -20; // 增大跳跃间距
            player.jump = true;
            jumpSound.play();
        }
        if (e.code === 'KeyA') {
            player.movingLeft = true;
        }
        if (e.code === 'KeyD') {
            player.movingRight = true;
        }
        if (e.code === 'KeyP') {
            paused = !paused;
            pauseStatus.style.display = paused ? 'block' : 'none';
        }
    });

    document.addEventListener('keyup', e => {
        if (e.code === 'KeyA') {
            player.movingLeft = false;
        }
        if (e.code === 'KeyD') {
            player.movingRight = false;
        }
    });

    setInterval(spawnItem, 3000);
    const countdown = setInterval(() => {
        if (paused) return;
        timeLeft--;
        timerDisplay.innerText = `剩余时间：${timeLeft}秒`;
        if (timeLeft <= 0) {
            clearInterval(countdown);
            alert(`游戏结束！你的得分为：${score}`);
            const name = prompt('请输入你的姓名记录得分：');
            if (name) leaderboard.push({ name, score });
            console.table(leaderboard);
        }
    }, 1000);
</script>
</body>
</html>
